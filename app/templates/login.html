<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Login - MyLineBotProject</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- OneSignal v16 -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js"></script>
    <script>
        // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ OneSignal (‡πÉ‡∏ä‡πâ appId ‡∏Ç‡∏≠‡∏á '‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ') ---
        window.OneSignalDeferred = window.OneSignalDeferred || [];
        OneSignalDeferred.push(async function (OneSignal) {
            await OneSignal.init({ appId: "734a6a1a-34a2-497a-a7e7-2e1e45d46bea" });
        });

        // --- helper ‡∏ï‡∏£‡∏ß‡∏à iOS ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á ---
        const isIOS = () => /iPhone|iPad|iPod/i.test(navigator.userAgent);
        const isStandalone = () =>
            window.matchMedia('(display-mode: standalone)').matches || navigator.standalone === true;

        // ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ Add to Home Screen (‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
        function showA2HSHintOnce() {
            if (!isIOS() || isStandalone()) return;
            if (localStorage.getItem('a2hs_hint_shown')) return;

            const bar = document.createElement('div');
            bar.style = "position:fixed;left:0;right:0;bottom:0;z-index:9998;background:#111;color:#fff;padding:12px 14px;display:flex;gap:10px;align-items:center";
            bar.innerHTML = `
            <span style="font-size:20px">üì≤</span>
            <span> ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô
            </span>
                <button id="hint-close" style="margin-left:auto;background:#2f80ed;color:#fff;border:0;border-radius:8px;padding:6px 10px">‡∏õ‡∏¥‡∏î</button>
            `;
            document.body.appendChild(bar);
            document.getElementById('hint-close').onclick = () => {
                localStorage.setItem('a2hs_hint_shown', '1');
                bar.remove();
            };
        }

        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('enable-push');

            // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï (‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏ñ‡∏≤‡∏°)
            const perm = (typeof Notification !== "undefined" && Notification.permission) || "default";
            if (perm !== 'granted') {
                btn.style.display = 'inline-block';
            }

            // iOS ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Add to Home Screen ‚Üí ‡πÇ‡∏ä‡∏ß‡πå‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á
            showA2HSHintOnce();

            // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏ï‡∏≤‡∏°‡∏Å‡∏é iOS ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ô click handler ‡∏ï‡∏£‡∏á ‡πÜ)
            btn.addEventListener('click', () => {
                if (isIOS() && !isStandalone()) {
                    alert(
                        "‡∏£‡∏∞‡∏ö‡∏ö iOS ‡πÄ‡∏ä‡πà‡∏ô iPhone ‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ\n" +
                        "1. ‡∏Å‡∏î‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå ‡∏Ç‡∏ß‡∏≤‡∏°‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå\n" +
                        "2. ‡∏Å‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏Æ‡∏°\n" +
                        "‡∏ó‡∏≥ 2 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏∞"
                    );
                    return;
                }
                try { OneSignal.Slidedown.promptPush(); } catch (e) { }
            });

            // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á ‡∏Ñ‡πà‡∏≠‡∏¢‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏° (‡πÇ‡∏û‡∏•‡∏•‡∏¥‡πà‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏ö‡∏≤ ‡πÜ)
            const t = setInterval(() => {
                const p = (typeof Notification !== "undefined" && Notification.permission) || "default";
                if (p === 'granted') { btn.style.display = 'none'; clearInterval(t); }
            }, 1000);
        });
    </script>
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ) -->
    <button id="enable-push" style="position:fixed; right:16px; bottom:16px; z-index:9999;
               padding:10px 14px; border:0; border-radius:999px;
               box-shadow:0 6px 20px rgba(0,0,0,.15);
               background:#2f80ed; color:#fff; display:none;">
        üì± ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô
    </button>
    <script>
        const btn = document.getElementById('enable-push');
        const bar = document.getElementById('a2hsBar'); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô id/class ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ö‡∏•‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏à‡∏£‡∏¥‡∏á
        const pad = 90;                                  // ‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ö

        function bump() {
            const h = bar ? bar.getBoundingClientRect().height : 0;
            // ‡∏¢‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÅ‡∏ñ‡∏ö + ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ safe-area (iPhone ‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏á)
            btn.style.bottom = `calc(env(safe-area-inset-bottom, 0px) + ${16 + h + pad}px)`;
        }

        bump();
        window.addEventListener('resize', bump);
    </script>

</head>

<body class="bg-light d-flex align-items-center" style="height: 100vh;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="card shadow-lg border-0 rounded-3">
                    <div class="card-header text-center bg-primary text-white">
                        <h4>Login</h4>
                    </div>
                    <div class="card-body">
                        {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                        {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        {% endfor %}
                        {% endif %}
                        {% endwith %}
                        <form method="POST" action="{{ url_for('main.login') }}">
                            <div class="mb-3">
                                <label for="username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="username" name="username" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="password" name="password" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Login</button>
                        </form>
                    </div>
                    <div class="card-footer text-center">
                        <small class="text-muted">¬© 2025 MyLineBotProject</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
