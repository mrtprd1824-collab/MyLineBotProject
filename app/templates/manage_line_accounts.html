{% extends "base.html" %}
{% block body_content %}
<div class="container mt-4">
  <h2>Manage LINE Accounts</h2>

  <!-- Add Account Form -->
  <form method="POST" action="{{ url_for('main.manage_line_accounts') }}">
    <div class="mb-3">
      <label class="form-label">Account Name</label>
      <input type="text" name="name" class="form-control" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Channel ID</label>
      <input type="text" name="channel_id" class="form-control" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Channel Secret</label>
      <input type="text" name="channel_secret" class="form-control" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Channel Access Token</label>
      <input type="text" name="channel_access_token" class="form-control" required>
    </div>
    <button type="submit" class="btn btn-primary">Add Account</button>
  </form>

  <hr>

  <!-- Accounts Table -->
  <h4>Existing Accounts</h4>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Name</th>
        <th>Channel ID</th>
        <th>Webhook URL</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for acc in line_accounts %}
      <tr>
        <td>{{ acc.name }}</td>
        <td>{{ acc.channel_id }}</td>
        <td>
          <input type="text" class="form-control webhook-url" 
                 value="{{ base_url }}/webhook/{{ acc.id }}" readonly onclick="copyToClipboard(this)">
        </td>
        <td>
          <form method="POST" action="{{ url_for('main.delete_line_account', acc_id=acc.id) }}" style="display:inline;">
              <button type="submit" class="btn btn-danger btn-sm"
                  onclick="return confirm('Are you sure you want to delete this account?');">
                  Delete
              </button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="4" class="text-center">No accounts added yet.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
function copyToClipboard(input) {
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  alert("Copied: " + input.value);
}
</script>
{% endblock %}
